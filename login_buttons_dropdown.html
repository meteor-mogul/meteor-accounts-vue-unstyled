<body>
<!--           -->
<!-- LOGGED IN -->
<!--           -->
  <script type="text/x-template" id="login-buttons-logged-in-dropdown-template">
    <div class="login-link-and-dropdown-list">
      <a class="login-link-text" id="login-name-link">
        {{displayName}} ▾
      </a>

      <div v-if="dropdownVisible">
        <div id="login-dropdown-list" class="accounts-dialog">
          <a class="login-close-text">Close</a>
          <div class="login-close-text-clear"></div>
          <div v-if="inMessageOnlyFlow">
            <login-buttons-messages></login-buttons-messages>
          </div>
          <div v-else>
            <div v-if="inChangePasswordFlow">
              _loginButtonsChangePassword
            </div>
            <div v-else>
              <login-buttons-logged-in-dropdown-actions></login-buttons-logged-in-dropdown-actions>
            </div>
          </div>
        </div>
      </div>
    </div>
  </script>

  <script type="text/x-template" id="login-buttons-logged-in-dropdown-actions-template">
    <div>
      <div v-if="allowChangingPassword">
        <div class="login-button" id="login-buttons-open-change-password">
          Change password
        </div>
      </div>

      <div class="login-button" id="login-buttons-logout">
        Sign out
      </div>

      <login-buttons-messages></login-buttons-messages>
    </div>
  </script>

<!--            -->
<!-- LOGGED OUT -->
<!--            -->
<script type="text/x-template" id="login-buttons-logged-out-dropdown-template">
  <div class="login-link-and-dropdown-list"> <!--  {{additionalClasses}} -->
    <div v-if="dropdownVisible">
      <!-- This text is covered by the dropdown, but duplicating it here
           makes the position of "Close" match the position of this text. -->
       <a class="login-link-text" id="login-sign-in-link">Sign in ▾</a>
       <div id="login-dropdown-list" class="accounts-dialog">
         <a class="login-close-text">Close</a>
         <div v-if="loggingIn">
           <login-buttons-logging-in></login-buttons-logging-in>
         </div>
         <div class="login-close-text-clear"></div>
         <login-buttons-logged-out-all-services></login-buttons-logged-out-all-services>
       </div>
    </div>
    <div v-else>
      <div v-if="loggingIn">
        <!-- Not normally visible, but if the user closes the dropdown during login. -->
        <login-buttons-logging-in></login-buttons-logging-in>
      </div>
      <div v-else>
        <a class="login-link-text" id="login-sign-in-link">Sign in ▾</a>
      </div>
    </div>
  </div>
</script>

<script type="text/x-template" id="login-buttons-logged-out-all-services-template">
  <div>
    <div v-for="service in services">
      _loginButtonsLoggedOutAllServices
      <div v-if="isPasswordService(service)">
        Is password service.
      </div>
    </div>
    <div v-if="!hasPasswordService">
      No password service.
      <login-buttons-messages :errorMessage="'Error Message Here'"
                              :infoMessage="'Info Message Here'"></login-buttons-messages>
    </div>
  </div>
</script>

<template name="_loginButtonsLoggedOutAllServices">
  {{#each services}}
    {{#if isPasswordService}}
      {{#if hasOtherServices}} {{! the password service will always come last }}
        {{> _loginButtonsLoggedOutPasswordServiceSeparator}}
      {{/if}}
      {{> _loginButtonsLoggedOutPasswordService}}
    {{else}}
      {{> _loginButtonsLoggedOutSingleLoginButton}}
    {{/if}}
  {{/each}}

  {{#unless hasPasswordService}}
    {{> _loginButtonsMessages}}
  {{/unless}}
</template>

<template name="_loginButtonsLoggedOutPasswordServiceSeparator">
  <div class="or">
    <span class="hline">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <span class="or-text">or</span>
    <span class="hline">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
  </div>
</template>

<template name="_loginButtonsLoggedOutPasswordService">
  {{#if inForgotPasswordFlow}}
    {{> _forgotPasswordForm}}
  {{else}}
    <form class="login-form login-password-form">
      {{#each fields}}
        {{> _loginButtonsFormField}}
      {{/each}}

      {{> _loginButtonsMessages}}

      <button
        class="login-button login-button-form-submit"
        id="login-buttons-password"
      >
        {{#if inSignupFlow}}
          Create account
        {{else}}
          Sign in
        {{/if}}
      </button>

      {{#if inLoginFlow}}
        {{#if showCreateAccountLink}}
          <div class="additional-link-container">
            <a id="signup-link" class="additional-link">Create account</a>
          </div>
        {{/if}}

        {{#if showForgotPasswordLink}}
          <div class="additional-link-container">
            <a id="forgot-password-link" class="additional-link">Forgot password</a>
          </div>
        {{/if}}
      {{/if}}

      {{#if inSignupFlow}}
        {{> _loginButtonsBackToLoginLink}}
      {{/if}}
    </form>
  {{/if}}
</template>

<template name="_forgotPasswordForm">
  <div class="login-form">
    <div id="forgot-password-email-label-and-input"> {{! XXX we should probably use loginButtonsFormField }}
      <label id="forgot-password-email-label" for="forgot-password-email">Email</label>
      <input id="forgot-password-email" type="email"/>
    </div>

    {{> _loginButtonsMessages}}

    <div class="login-button login-button-form-submit" id="login-buttons-forgot-password">
      Reset password
    </div>

    {{> _loginButtonsBackToLoginLink}}
  </div>
</template>

<template name="_loginButtonsBackToLoginLink">
  <div class="additional-link-container">
    <a id="back-to-login-link" class="additional-link">Sign in</a>
  </div>
</template>

<template name="_loginButtonsFormField">
  {{#if visible}}
    <div id="login-{{fieldName}}-label-and-input">
      <label id="login-{{fieldName}}-label" for="login-{{fieldName}}">
        {{fieldLabel}}
      </label>
      <input id="login-{{fieldName}}" type="{{inputType}}" />
    </div>
  {{/if}}
</template>

<template name="_loginButtonsChangePassword">
  {{#each fields}}
    {{> _loginButtonsFormField}}
  {{/each}}

  {{> _loginButtonsMessages}}

  <div class="login-button login-button-form-submit" id="login-buttons-do-change-password">
    Change password
  </div>
</template>
</body>
